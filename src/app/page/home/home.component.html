<div class="container-fluid ">
  <div class="container py-3 px-4 py-4 px-sm-1 px-md-3 px-lg-3" style="min-height: 80vh;">

    <ng-container *ngIf="!loading; else isLoading">
      <ng-container *ngIf="jobs.length > 0; else noJobs">

        <div class="container" style="display: flex; justify-content: flex-end; margin: 1rem 0;">
          <button class="btn btn-primary" (click)="createNewJob(newJobForm)">Add New Job</button>
        </div>

        <ngb-accordion [closeOthers]="true" [activeIds]="'static-0'">
          <ngb-panel [id]="'static-' + i" [title]="job.title" *ngFor="let job of jobs; let i = index">
            <ng-template ngbPanelContent>
              <div class="description">
                <p>{{job.description}}</p>
              </div>
              <h6>Tasks/Steps <button class="btn btn-light" (click)="toggleAddStepForm(job)"><span class="icon-addicon"></span></button> </h6>
              <ng-container  *ngIf="job.steps && job.steps.length > 0">
                <ul>
                  <li *ngFor="let step of job.steps" ngbDropdown >
                    {{step.title}} <span [class]="'icon-dots-3 ' + 'utility_menu utility_menu_step_' + step.id" [id]="'step_dropdown_' + step.id" ngbDropdownToggle></span>
                    <h6>Hazards  <button class="btn btn-light"><span class="icon-addicon"></span> </button></h6>
                    <ng-container *ngIf="step && step.hazards &&  step.hazards.length > 0">

                      <ul>
                        <li *ngFor="let hazard of step.hazards">
                          {{hazard.title}} <span [class]="'icon-dots-3 ' + 'utility_menu utility_menu_hazard_' + hazard.id"></span>
                          <h6>Safeguards <button class="btn btn-light"><span class="icon-addicon"></span> </button></h6>
                          <ng-container  *ngIf="hazard.safeguards.length > 0">

                            <ul>
                              <li *ngFor="let safeguard of hazard.safeguards">
                                {{safeguard.id + ' ' + safeguard.title}} <span [class]="'icon-dots-3 ' + 'utility_menu utility_menu_safeguard_' + safeguard.id"></span>
                              </li>
                            </ul>
                          </ng-container>
                        </li>
                      </ul>
                    </ng-container>
                    <div ngbDropdownMenu [attr.aria-labelledby]="'step_dropdown_' + step.id">
                      <button ngbDropdownItem (click)="editStep(step)">Edit {{step.id}}</button>
                      <button ngbDropdownItem (click)="deleteStep(step)">Delete Step {{step.id}}</button>
                    </div>
                  </li>
                </ul>
              </ng-container>
              <ng-container *ngIf="showAddStepForm">
                <form (ngSubmit)="doAddStep(f, job)" #f="ngForm">
                  <div class="form-group">
                    <label for="title"></label>
                    <input type="text" id="title" name="title" ngModel class="form-control">
                  </div>
                  <div class="actions">
                    <button class="btn btn-light">Add</button>
                  </div>
                </form>
              </ng-container>
              <div class="actions">
                <button class="btn btn-primary" (click)="editJob(job)">Edit Job</button>
              </div>
            </ng-template>
          </ngb-panel>
        </ngb-accordion>
      </ng-container>

      <ng-template #noJobs>
        <div class="info-box">
          <p>There are currently no jobs.</p>
          <div class="action">
            <button class="btn btn-primary" (click)="createNewJob(newJobForm)">Add New Job</button>
          </div>
        </div>
      </ng-template>
    </ng-container>
  </div>
</div>

<ng-template #newJobForm let-newJobFormModal>
  <app-job-form (doEmitData)="doAddNewJob($event)" [modal]="newJobFormModal"></app-job-form>
</ng-template>
<ng-template #isLoading>
  <div class="load-spinner" style="display: flex; justify-content: center; align-items: center; min-height: 400px;">
    <app-loading></app-loading>
  </div>

</ng-template>

